const clickSound = document.getElementById("clickSound");

function sfx(){
  if(!clickSound) return;
  clickSound.currentTime = 0;
  clickSound.play().catch(()=>{});
}

/* ---------- Page Navigation ---------- */
function go(id){
  sfx();
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
  document.getElementById(id).classList.add("active");

  // Restart typewriter when page1 opens
  if(id === "page1"){
    startTypewriter();
  }
}

function goGift(n){
  go("gift" + n);
}

/* ---------- No Button Run Away (Desktop + Mobile) ---------- */
const noBtn = document.getElementById("noBtn");
const yesBtn = document.getElementById("yesBtn");

function moveNoButton(){
  const parent = document.querySelector("#page1 .btnRow");
  const rect = parent.getBoundingClientRect();

  const maxX = rect.width - noBtn.offsetWidth;
  const maxY = rect.height - noBtn.offsetHeight;

  const x = Math.random() * maxX;
  const y = Math.random() * maxY;

  noBtn.style.position = "absolute";
  noBtn.style.left = `${x}px`;
  noBtn.style.top = `${y}px`;
}

noBtn.addEventListener("mouseenter", moveNoButton);
noBtn.addEventListener("click", moveNoButton);
noBtn.addEventListener("touchstart", (e) => {
  e.preventDefault();
  moveNoButton();
});

/* YES button */
yesBtn.addEventListener("click", () => go("page2"));

/* ---------- Typewriter Effect ---------- */
let typingStarted = false;

function typeText(el, text, speed=35){
  return new Promise((resolve) => {
    el.textContent = "";
    let i = 0;
    const timer = setInterval(() => {
      el.textContent += text[i];
      i++;
      if(i >= text.length){
        clearInterval(timer);
        resolve();
      }
    }, speed);
  });
}

async function startTypewriter(){
  if(typingStarted) return;
  typingStarted = true;

  const els = document.querySelectorAll("#page1 .type");
  for(const el of els){
    await typeText(el, el.dataset.text, 30);
  }
}

/* ---------- Floating Hearts Generator ---------- */
const heartsBox = document.getElementById("hearts");
const heartEmojis = ["ðŸ’—","ðŸ’–","ðŸ’˜","ðŸ’","ðŸ’•","ðŸ’ž","â¤ï¸"];

function spawnHeart(){
  const h = document.createElement("div");
  h.className = "heart";
  h.textContent = heartEmojis[Math.floor(Math.random()*heartEmojis.length)];

  const left = Math.random() * 100;
  const size = 14 + Math.random()*22;
  const duration = 4 + Math.random()*5;

  h.style.left = left + "vw";
  h.style.fontSize = size + "px";
  h.style.animationDuration = duration + "s";

  heartsBox.appendChild(h);

  setTimeout(() => h.remove(), duration * 1000);
}

setInterval(spawnHeart, 280);

/* Start */
startTypewriter();

